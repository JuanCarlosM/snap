#!/usr/bin/python
#
# Snap! command line interface
#
# (C) Copyright 2011 Mo Morsi (mo@morsi.org)
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

import sys
import snap

class ConsoleCallback(snap.callback.SnapCallbackBase):
    def __init__(self)
        self.verbose=verbose

    def message(self, msg):
        print msg
    def warn(self, warning):
        print 'WARNING: ' + warning
    def error(self, error):
        print 'ERROR: ' + error

    def init_backup(self):
        print "Creating Snapshot"
    def backup_target(self, target):
        print " Backing up " + target
    def post_backup(self):
        print "Snapshot completed"

    def init_restore(self):
        print "Restoring snapshot"
    def restore_target(self, target):
        print " Restoring " + target
    def post_restore(self):
        print "Restore completed"

def main():
    snap.callback.snapcallback=ConsoleCallback()
    try:
        snapbase = snap.SnapBase()

        conf = snap.configmanager.Config(snapbase.options)
        conf.read_config()
        conf.parse_cli()
        conf.verify()

        if snapbase.options.mode == snapbase.options.RESTORE:
            snapbase.restore()
            return 0
        if snapbase.options.mode == snapbase.options.BACKUP:
            snapbase.backup()
            return 0

        return 1

    except (snap.exceptions.SnapError), e:
        return 1

if __name__ == "__main__":
    sys.exit(main())
